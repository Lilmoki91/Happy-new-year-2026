<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced IPFS Terminal Runner</title>
<style>
body {
  margin:0; padding:0; font-family:'JetBrains Mono', monospace;
  background:#050805; color:#00ff66; height:100vh; overflow:hidden;
}
#terminal {
  padding:16px; height:100vh; box-sizing:border-box;
  overflow:auto; white-space:pre-wrap; word-break:break-word;
  position:relative;
}
.cursor::after {
  content:"‚ñç"; margin-left:2px; animation:blink 1s infinite; color:white;
}
@keyframes blink {0%,50%{opacity:1}51%,100%{opacity:0}}
button {
  position:fixed; bottom:20px; right:20px;
  padding:10px 14px; border-radius:6px; border:none;
  background:#00ff66; color:#000; font-family:inherit;
  font-weight:bold; cursor:pointer; z-index:1000;
}
button:hover {background:#00dd55;}
iframe {width:100%; height:100%; border:none;}
.hidden {display:none;}
.rainbow-text {
  background: linear-gradient(45deg, #ff0000, #ff9900, #ffff00, #00ff00, #0099ff, #6600ff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  display: inline-block;
}
.fireworks {
  position: fixed;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: -1;
}
</style>
</head>
<body>

<div id="terminal" class="cursor"></div>
<button id="runBtn">‚ñ∂ Execute</button>

<script>
const terminalEl = document.getElementById('terminal');
const runBtn = document.getElementById('runBtn');
const CID = "QmSHv8XgzKTx1KaSytKyUCPTnHkMJUqdWN3xziaYUhC3jF";
const GATEWAY = `https://ipfs.io/ipfs/${CID}`;

/* Keyboard sounds */
const sounds = [1,2,3,4].map(i => {
  const s = new Audio(`https://motionape-website.s3.us-east-1.amazonaws.com/Freebies/SoundFX/Sounds/Keyboard/Keyboard-0${i}.mp3`);
  s.volume = 0.12;
  return s;
});

let loadingInterval;

/* TYPE EFFECT with sound */
function typeEffect(el, text, speed=20) {
  return new Promise(resolve=>{
    let i=0;
    const type = ()=>{
      el.textContent += text.charAt(i);
      if(i%3===0){
        const s = sounds[Math.floor(Math.random()*sounds.length)];
        s.currentTime=0; s.play().catch(()=>{});
      }
      i++;
      el.scrollTop = el.scrollHeight;
      if(i<text.length) setTimeout(type, speed + Math.random()*5);
      else resolve();
    };
    type();
  });
}

/* LOADING DOTS EFFECT */
function loadingDots(msg, duration=2000) {
  return new Promise(resolve=>{
    let d=0;
    clearInterval(loadingInterval);
    loadingInterval = setInterval(()=>{
      terminalEl.textContent = `${msg}${'.'.repeat(d%4)}`;
      d++;
      terminalEl.scrollTop = terminalEl.scrollHeight;
    },400);
    setTimeout(()=>{
      clearInterval(loadingInterval);
      terminalEl.textContent += "\n";
      resolve();
    }, duration);
  });
}

/* üéá HAPPY NEW YEAR 2026 GREETING */
async function newYearMessage() {
  const msg = 
`    ‚úßÔΩ•Ôæü: *‚úßÔΩ•Ôæü:*  *:ÔΩ•Ôæü‚úß*:ÔΩ•Ôæü‚úß
          üéâ HAPPY üéä
        ü•≥ NEW YEAR üéá
         ‚ú®  2026  ‚ú®                                      
    ‚úßÔΩ•Ôæü: *‚úßÔΩ•Ôæü:*  *:ÔΩ•Ôæü‚úß*:ÔΩ•Ôæü‚úß

‚ú® Happy New Year 2026! ‚ú®
May your code always compile successfully,
your metadata never get lost,
and your heart remain full of hope.

May 2026 bring:
‚Ä¢ Error-free compilation
‚Ä¢ Well-preserved metadata
‚Ä¢ A heart always filled with hope
‚Ä¢ Successful projects
‚Ä¢ A solid community
‚Ä¢ Limitless innovation

"In every line of code, there's a dream.
 In every commit, there's hope.
 Let's build the future together!" ‚ú®

`;

  // Typing effect + keyboard sounds
  await new Promise(resolve => {
    let i = 0;
    const type = () => {
      terminalEl.textContent += msg.charAt(i);
      if(i % 3 === 0){
        const s = sounds[Math.floor(Math.random() * sounds.length)];
        s.currentTime = 0; s.play().catch(()=>{});
      }
      i++;
      terminalEl.scrollTop = terminalEl.scrollHeight;
      if(i < msg.length) setTimeout(type, 5 + Math.random()*5);
      else resolve();
    };
    type();
  });

  // Persistent message with loading animation
  const loadingMsg = `‚ñ∂Ô∏è Click the 'Execute' button to access web portal`;
  let d = 0;
  clearInterval(loadingInterval);
  loadingInterval = setInterval(() => {
    terminalEl.textContent = msg + loadingMsg + '.'.repeat(d % 4);
    d++;
    terminalEl.scrollTop = terminalEl.scrollHeight;
  }, 400);
}

// Add New Year sound (confetti) on click
function playNewYearSound() {
  try {
    const newYearSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-happy-new-year-party-horn-sound-2956.mp3');
    newYearSound.volume = 0.3;
    newYearSound.play().catch(() => {});
  } catch (e) {
    console.log("New Year sound could not be played");
  }
}

// 1Ô∏è‚É£ Display greeting immediately after page loads
window.addEventListener('DOMContentLoaded', async () => {
  await newYearMessage();
});

runBtn.addEventListener('click', async () => {
  // Play New Year sound
  playNewYearSound();
  
  // Stop previous loading dots
  clearInterval(loadingInterval);
  runBtn.remove();

// 2Ô∏è‚É£ Loading IPFS fetching in English dengan loading dots integrated
await loadingDots("</> Fetching webhook metadata from IPFS", 3000);
await typeEffect(terminalEl,
`üì¶ Content ID (CID): ${CID}
# ----------------------------

üîó Gateway Path: ${GATEWAY}
# ----------------------------

üìä Status: Accessing IPFS node...
# ----------------------------

`, 20);

// Loading dengan mesej "Please wait..." dan dots
await new Promise(resolve => {
  let dots = 0;
  const loadingText = "‚è≥ Please wait";
  const interval = setInterval(() => {
    terminalEl.textContent += `\n${loadingText}${'.'.repeat(dots % 5)}`;
    terminalEl.scrollTop = terminalEl.scrollHeight;
    dots++;
  }, 400);
  
  setTimeout(() => {
    clearInterval(interval);
    terminalEl.textContent += "\n\n";
    resolve();
  }, 2000);
});

  // 3Ô∏è‚É£ Fetch HTML from IPFS and render in iframe
  try {
    await loadingDots("</> Download complete. Running application", 2500);

    const iframe = document.createElement('iframe');
    iframe.src = GATEWAY;
    iframe.style.width = "100%";
    iframe.style.height = "100%";
    iframe.style.border = "none";
    iframe.title = "Web Application from IPFS";

    terminalEl.innerHTML = "";
    terminalEl.appendChild(iframe);

  } catch(e) {
    await typeEffect(terminalEl, `‚ùå Error fetching from IPFS: ${e}\n`, 10);
    await typeEffect(terminalEl, `üîÑ Retrying with alternative gateway...\n`, 20);
    
    // Try alternative gateway
    const altGateway = `https://cloudflare-ipfs.com/ipfs/${CID}`;
    const iframe = document.createElement('iframe');
    iframe.src = altGateway;
    iframe.style.width = "100%";
    iframe.style.height = "100%";
    iframe.style.border = "none";
    terminalEl.appendChild(iframe);
  }
});
</script>

</body>
</html>
